; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -passes=isolate-path -S < %s | FileCheck --check-prefix=UNREACHABLE %s
; RUN: opt -passes=isolate-path -isolate-ub-path-to-trap-unreachable -S < %s | FileCheck --check-prefix=TRAP-UNREACHABLE %s

%struct.demangle_component = type { i32, i32 }

define dso_local ptr @test1(ptr noundef readonly captures(none) %di) {
; UNREACHABLE-LABEL: define dso_local ptr @test1(
; UNREACHABLE-SAME: ptr noundef readonly captures(none) [[DI:%.*]]) {
; UNREACHABLE-NEXT:  [[ENTRY:.*:]]
; UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; UNREACHABLE-NEXT:    br i1 [[CMP_NOT_I]], label %[[IF_END_I:.*]], label %[[EXIT_UB_PATH:.*]]
; UNREACHABLE:       [[IF_END_I]]:
; UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; UNREACHABLE-NEXT:    br label %[[EXIT:.*]]
; UNREACHABLE:       [[EXIT]]:
; UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ [[ARRAYIDX_I]], %[[IF_END_I]] ]
; UNREACHABLE-NEXT:    [[TMP3:%.*]] = load i32, ptr [[RETVAL_0_I]], align 4
; UNREACHABLE-NEXT:    call void @foo(i32 noundef [[TMP3]])
; UNREACHABLE-NEXT:    [[ZZZ:%.*]] = getelementptr inbounds nuw i8, ptr [[RETVAL_0_I]], i64 4
; UNREACHABLE-NEXT:    [[TMP4:%.*]] = load i32, ptr [[ZZZ]], align 4
; UNREACHABLE-NEXT:    call void @bar(i32 noundef [[TMP4]])
; UNREACHABLE-NEXT:    ret ptr [[RETVAL_0_I]]
; UNREACHABLE:       [[EXIT_UB_PATH]]:
; UNREACHABLE-NEXT:    unreachable
;
; TRAP-UNREACHABLE-LABEL: define dso_local ptr @test1(
; TRAP-UNREACHABLE-SAME: ptr noundef readonly captures(none) [[DI:%.*]]) {
; TRAP-UNREACHABLE-NEXT:  [[ENTRY:.*]]:
; TRAP-UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; TRAP-UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; TRAP-UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; TRAP-UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; TRAP-UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; TRAP-UNREACHABLE-NEXT:    br i1 [[CMP_NOT_I]], label %[[IF_END_I:.*]], label %[[EXIT_UB_PATH:.*]]
; TRAP-UNREACHABLE:       [[IF_END_I]]:
; TRAP-UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; TRAP-UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; TRAP-UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; TRAP-UNREACHABLE-NEXT:    br label %[[EXIT:.*]]
; TRAP-UNREACHABLE:       [[EXIT]]:
; TRAP-UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ [[ARRAYIDX_I]], %[[IF_END_I]] ]
; TRAP-UNREACHABLE-NEXT:    [[TMP3:%.*]] = load i32, ptr [[RETVAL_0_I]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @foo(i32 noundef [[TMP3]])
; TRAP-UNREACHABLE-NEXT:    [[ZZZ:%.*]] = getelementptr inbounds nuw i8, ptr [[RETVAL_0_I]], i64 4
; TRAP-UNREACHABLE-NEXT:    [[TMP4:%.*]] = load i32, ptr [[ZZZ]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @bar(i32 noundef [[TMP4]])
; TRAP-UNREACHABLE-NEXT:    ret ptr [[RETVAL_0_I]]
; TRAP-UNREACHABLE:       [[EXIT_UB_PATH]]:
; TRAP-UNREACHABLE-NEXT:    [[RETVAL_0_I_UB_PATH:%.*]] = phi ptr [ null, %[[ENTRY]] ]
; TRAP-UNREACHABLE-NEXT:    [[TMP5:%.*]] = load volatile i32, ptr [[RETVAL_0_I_UB_PATH]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @llvm.trap()
; TRAP-UNREACHABLE-NEXT:    unreachable
;
entry:
  %next_comp.i = getelementptr inbounds nuw i8, ptr %di, i64 8
  %0 = load i32, ptr %next_comp.i, align 8
  %num_comps.i = getelementptr inbounds nuw i8, ptr %di, i64 12
  %1 = load i32, ptr %num_comps.i, align 4
  %cmp.not.i = icmp slt i32 %0, %1
  br i1 %cmp.not.i, label %if.end.i, label %exit

if.end.i:
  %2 = load ptr, ptr %di, align 8
  %idxprom.i = sext i32 %0 to i64
  %arrayidx.i = getelementptr inbounds %struct.demangle_component, ptr %2, i64 %idxprom.i
  br label %exit

exit:
  %retval.0.i = phi ptr [ %arrayidx.i, %if.end.i ], [ null, %entry ]
  %3 = load i32, ptr %retval.0.i, align 4
  call void @foo(i32 noundef %3)
  %zzz = getelementptr inbounds nuw i8, ptr %retval.0.i, i64 4
  %4 = load i32, ptr %zzz, align 4
  call void @bar(i32 noundef %4)
  ret ptr %retval.0.i
}

define dso_local ptr @test2(ptr noundef readonly captures(none) %di) {
; UNREACHABLE-LABEL: define dso_local ptr @test2(
; UNREACHABLE-SAME: ptr noundef readonly captures(none) [[DI:%.*]]) {
; UNREACHABLE-NEXT:  [[ENTRY:.*]]:
; UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; UNREACHABLE-NEXT:    br i1 [[CMP_NOT_I]], label %[[IF_END_I:.*]], label %[[EXIT:.*]]
; UNREACHABLE:       [[IF_END_I]]:
; UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; UNREACHABLE-NEXT:    [[CMP:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; UNREACHABLE-NEXT:    br i1 [[CMP]], label %[[EXIT]], label %[[RETURN:.*]]
; UNREACHABLE:       [[EXIT]]:
; UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ null, %[[IF_END_I]] ], [ null, %[[ENTRY]] ]
; UNREACHABLE-NEXT:    [[TMP3:%.*]] = load i32, ptr [[RETVAL_0_I]], align 4
; UNREACHABLE-NEXT:    call void @foo(i32 noundef [[TMP3]])
; UNREACHABLE-NEXT:    [[ZZZ:%.*]] = getelementptr inbounds nuw i8, ptr [[RETVAL_0_I]], i64 4
; UNREACHABLE-NEXT:    [[TMP4:%.*]] = load i32, ptr [[ZZZ]], align 4
; UNREACHABLE-NEXT:    call void @bar(i32 noundef [[TMP4]])
; UNREACHABLE-NEXT:    br label %[[RETURN]]
; UNREACHABLE:       [[RETURN]]:
; UNREACHABLE-NEXT:    ret ptr null
;
; TRAP-UNREACHABLE-LABEL: define dso_local ptr @test2(
; TRAP-UNREACHABLE-SAME: ptr noundef readonly captures(none) [[DI:%.*]]) {
; TRAP-UNREACHABLE-NEXT:  [[ENTRY:.*]]:
; TRAP-UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; TRAP-UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; TRAP-UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; TRAP-UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; TRAP-UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; TRAP-UNREACHABLE-NEXT:    br i1 [[CMP_NOT_I]], label %[[IF_END_I:.*]], label %[[EXIT:.*]]
; TRAP-UNREACHABLE:       [[IF_END_I]]:
; TRAP-UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; TRAP-UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; TRAP-UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; TRAP-UNREACHABLE-NEXT:    [[CMP:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; TRAP-UNREACHABLE-NEXT:    br i1 [[CMP]], label %[[EXIT]], label %[[RETURN:.*]]
; TRAP-UNREACHABLE:       [[EXIT]]:
; TRAP-UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ null, %[[IF_END_I]] ], [ null, %[[ENTRY]] ]
; TRAP-UNREACHABLE-NEXT:    [[TMP3:%.*]] = load i32, ptr [[RETVAL_0_I]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @foo(i32 noundef [[TMP3]])
; TRAP-UNREACHABLE-NEXT:    [[ZZZ:%.*]] = getelementptr inbounds nuw i8, ptr [[RETVAL_0_I]], i64 4
; TRAP-UNREACHABLE-NEXT:    [[TMP4:%.*]] = load i32, ptr [[ZZZ]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @bar(i32 noundef [[TMP4]])
; TRAP-UNREACHABLE-NEXT:    br label %[[RETURN]]
; TRAP-UNREACHABLE:       [[RETURN]]:
; TRAP-UNREACHABLE-NEXT:    ret ptr null
;
entry:
  %next_comp.i = getelementptr inbounds nuw i8, ptr %di, i64 8
  %0 = load i32, ptr %next_comp.i, align 8
  %num_comps.i = getelementptr inbounds nuw i8, ptr %di, i64 12
  %1 = load i32, ptr %num_comps.i, align 4
  %cmp.not.i = icmp slt i32 %0, %1
  br i1 %cmp.not.i, label %if.end.i, label %exit

if.end.i:
  %2 = load ptr, ptr %di, align 8
  %idxprom.i = sext i32 %0 to i64
  %arrayidx.i = getelementptr inbounds %struct.demangle_component, ptr %2, i64 %idxprom.i
  %cmp = icmp slt i32 %0, %1
  br i1 %cmp, label %exit, label %return

exit:
  %retval.0.i = phi ptr [ null, %if.end.i ], [ null, %entry ]
  %3 = load i32, ptr %retval.0.i, align 4
  call void @foo(i32 noundef %3)
  %zzz = getelementptr inbounds nuw i8, ptr %retval.0.i, i64 4
  %4 = load i32, ptr %zzz, align 4
  call void @bar(i32 noundef %4)
  br label %return

return:
  ret ptr null
}

define dso_local ptr @test3(i32 %choice, ptr noundef %di, ptr noundef %si) {
; UNREACHABLE-LABEL: define dso_local ptr @test3(
; UNREACHABLE-SAME: i32 [[CHOICE:%.*]], ptr noundef [[DI:%.*]], ptr noundef [[SI:%.*]]) {
; UNREACHABLE-NEXT:  [[ENTRY:.*:]]
; UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; UNREACHABLE-NEXT:    switch i32 [[CHOICE]], label %[[SW_EPILOG_UB_PATH:.*]] [
; UNREACHABLE-NEXT:      i32 42, label %[[SW_BB:.*]]
; UNREACHABLE-NEXT:      i32 3, label %[[SW_BB1:.*]]
; UNREACHABLE-NEXT:    ]
; UNREACHABLE:       [[SW_BB]]:
; UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; UNREACHABLE-NEXT:    br label %[[SW_EPILOG:.*]]
; UNREACHABLE:       [[SW_BB1]]:
; UNREACHABLE-NEXT:    [[SI_VAL:%.*]] = load ptr, ptr [[SI]], align 8
; UNREACHABLE-NEXT:    [[IDXPROM_I_1:%.*]] = sext i32 [[TMP0]] to i64
; UNREACHABLE-NEXT:    [[ARRAYIDX_I_1:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT]], ptr [[SI_VAL]], i64 [[IDXPROM_I_1]]
; UNREACHABLE-NEXT:    br label %[[SW_EPILOG]]
; UNREACHABLE:       [[SW_EPILOG]]:
; UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ [[ARRAYIDX_I]], %[[SW_BB]] ], [ [[ARRAYIDX_I_1]], %[[SW_BB1]] ]
; UNREACHABLE-NEXT:    [[TMP3:%.*]] = load i32, ptr [[RETVAL_0_I]], align 4
; UNREACHABLE-NEXT:    call void @foo(i32 noundef [[TMP3]])
; UNREACHABLE-NEXT:    [[ZZZ:%.*]] = getelementptr inbounds nuw i8, ptr [[RETVAL_0_I]], i64 4
; UNREACHABLE-NEXT:    [[TMP4:%.*]] = load i32, ptr [[ZZZ]], align 4
; UNREACHABLE-NEXT:    call void @bar(i32 noundef [[TMP4]])
; UNREACHABLE-NEXT:    br label %[[EXIT:.*]]
; UNREACHABLE:       [[EXIT]]:
; UNREACHABLE-NEXT:    ret ptr [[RETVAL_0_I]]
; UNREACHABLE:       [[SW_EPILOG_UB_PATH]]:
; UNREACHABLE-NEXT:    unreachable
;
; TRAP-UNREACHABLE-LABEL: define dso_local ptr @test3(
; TRAP-UNREACHABLE-SAME: i32 [[CHOICE:%.*]], ptr noundef [[DI:%.*]], ptr noundef [[SI:%.*]]) {
; TRAP-UNREACHABLE-NEXT:  [[ENTRY:.*]]:
; TRAP-UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; TRAP-UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; TRAP-UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; TRAP-UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; TRAP-UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; TRAP-UNREACHABLE-NEXT:    switch i32 [[CHOICE]], label %[[SW_EPILOG_UB_PATH:.*]] [
; TRAP-UNREACHABLE-NEXT:      i32 42, label %[[SW_BB:.*]]
; TRAP-UNREACHABLE-NEXT:      i32 3, label %[[SW_BB1:.*]]
; TRAP-UNREACHABLE-NEXT:    ]
; TRAP-UNREACHABLE:       [[SW_BB]]:
; TRAP-UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; TRAP-UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; TRAP-UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; TRAP-UNREACHABLE-NEXT:    br label %[[SW_EPILOG:.*]]
; TRAP-UNREACHABLE:       [[SW_BB1]]:
; TRAP-UNREACHABLE-NEXT:    [[SI_VAL:%.*]] = load ptr, ptr [[SI]], align 8
; TRAP-UNREACHABLE-NEXT:    [[IDXPROM_I_1:%.*]] = sext i32 [[TMP0]] to i64
; TRAP-UNREACHABLE-NEXT:    [[ARRAYIDX_I_1:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT]], ptr [[SI_VAL]], i64 [[IDXPROM_I_1]]
; TRAP-UNREACHABLE-NEXT:    br label %[[SW_EPILOG]]
; TRAP-UNREACHABLE:       [[SW_EPILOG]]:
; TRAP-UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ [[ARRAYIDX_I]], %[[SW_BB]] ], [ [[ARRAYIDX_I_1]], %[[SW_BB1]] ]
; TRAP-UNREACHABLE-NEXT:    [[TMP3:%.*]] = load i32, ptr [[RETVAL_0_I]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @foo(i32 noundef [[TMP3]])
; TRAP-UNREACHABLE-NEXT:    [[ZZZ:%.*]] = getelementptr inbounds nuw i8, ptr [[RETVAL_0_I]], i64 4
; TRAP-UNREACHABLE-NEXT:    [[TMP4:%.*]] = load i32, ptr [[ZZZ]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @bar(i32 noundef [[TMP4]])
; TRAP-UNREACHABLE-NEXT:    br label %[[EXIT:.*]]
; TRAP-UNREACHABLE:       [[EXIT]]:
; TRAP-UNREACHABLE-NEXT:    ret ptr [[RETVAL_0_I]]
; TRAP-UNREACHABLE:       [[SW_EPILOG_UB_PATH]]:
; TRAP-UNREACHABLE-NEXT:    [[RETVAL_0_I_UB_PATH:%.*]] = phi ptr [ null, %[[ENTRY]] ]
; TRAP-UNREACHABLE-NEXT:    [[TMP5:%.*]] = load volatile i32, ptr [[RETVAL_0_I_UB_PATH]], align 4
; TRAP-UNREACHABLE-NEXT:    call void @llvm.trap()
; TRAP-UNREACHABLE-NEXT:    unreachable
;
entry:
  %next_comp.i = getelementptr inbounds nuw i8, ptr %di, i64 8
  %0 = load i32, ptr %next_comp.i, align 8
  %num_comps.i = getelementptr inbounds nuw i8, ptr %di, i64 12
  %1 = load i32, ptr %num_comps.i, align 4
  %cmp.not.i = icmp slt i32 %0, %1
  switch i32 %choice, label %sw.epilog [
  i32 42, label %sw.bb
  i32 3, label %sw.bb1
  ]

sw.bb:
  %2 = load ptr, ptr %di, align 8
  %idxprom.i = sext i32 %0 to i64
  %arrayidx.i = getelementptr inbounds %struct.demangle_component, ptr %2, i64 %idxprom.i
  br label %sw.epilog

sw.bb1:
  %si.val = load ptr, ptr %si, align 8
  %idxprom.i.1 = sext i32 %0 to i64
  %arrayidx.i.1 = getelementptr inbounds %struct.demangle_component, ptr %si.val, i64 %idxprom.i.1
  br label %sw.epilog

sw.epilog:
  %retval.0.i = phi ptr [ %arrayidx.i, %sw.bb ], [ %arrayidx.i.1, %sw.bb1], [ null, %entry ]
  %3 = load i32, ptr %retval.0.i, align 4
  call void @foo(i32 noundef %3)
  %zzz = getelementptr inbounds nuw i8, ptr %retval.0.i, i64 4
  %4 = load i32, ptr %zzz, align 4
  call void @bar(i32 noundef %4)
  br label %exit

exit:
  ret ptr %retval.0.i
}

define dso_local ptr @test4(ptr noundef readonly captures(none) %di) {
; UNREACHABLE-LABEL: define dso_local ptr @test4(
; UNREACHABLE-SAME: ptr noundef readonly captures(none) [[DI:%.*]]) {
; UNREACHABLE-NEXT:  [[ENTRY:.*:]]
; UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; UNREACHABLE-NEXT:    br i1 [[CMP_NOT_I]], label %[[IF_END_I:.*]], label %[[D_MAKE_EMPTY_EXIT_UB_PATH:.*]]
; UNREACHABLE:       [[IF_END_I]]:
; UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; UNREACHABLE-NEXT:    br label %[[D_MAKE_EMPTY_EXIT:.*]]
; UNREACHABLE:       [[D_MAKE_EMPTY_EXIT]]:
; UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ [[ARRAYIDX_I]], %[[IF_END_I]] ]
; UNREACHABLE-NEXT:    store i32 42, ptr [[RETVAL_0_I]], align 4
; UNREACHABLE-NEXT:    ret ptr [[RETVAL_0_I]]
; UNREACHABLE:       [[D_MAKE_EMPTY_EXIT_UB_PATH]]:
; UNREACHABLE-NEXT:    unreachable
;
; TRAP-UNREACHABLE-LABEL: define dso_local ptr @test4(
; TRAP-UNREACHABLE-SAME: ptr noundef readonly captures(none) [[DI:%.*]]) {
; TRAP-UNREACHABLE-NEXT:  [[ENTRY:.*]]:
; TRAP-UNREACHABLE-NEXT:    [[NEXT_COMP_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 8
; TRAP-UNREACHABLE-NEXT:    [[TMP0:%.*]] = load i32, ptr [[NEXT_COMP_I]], align 8
; TRAP-UNREACHABLE-NEXT:    [[NUM_COMPS_I:%.*]] = getelementptr inbounds nuw i8, ptr [[DI]], i64 12
; TRAP-UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr [[NUM_COMPS_I]], align 4
; TRAP-UNREACHABLE-NEXT:    [[CMP_NOT_I:%.*]] = icmp slt i32 [[TMP0]], [[TMP1]]
; TRAP-UNREACHABLE-NEXT:    br i1 [[CMP_NOT_I]], label %[[IF_END_I:.*]], label %[[D_MAKE_EMPTY_EXIT_UB_PATH:.*]]
; TRAP-UNREACHABLE:       [[IF_END_I]]:
; TRAP-UNREACHABLE-NEXT:    [[TMP2:%.*]] = load ptr, ptr [[DI]], align 8
; TRAP-UNREACHABLE-NEXT:    [[IDXPROM_I:%.*]] = sext i32 [[TMP0]] to i64
; TRAP-UNREACHABLE-NEXT:    [[ARRAYIDX_I:%.*]] = getelementptr inbounds [[STRUCT_DEMANGLE_COMPONENT:%.*]], ptr [[TMP2]], i64 [[IDXPROM_I]]
; TRAP-UNREACHABLE-NEXT:    br label %[[D_MAKE_EMPTY_EXIT:.*]]
; TRAP-UNREACHABLE:       [[D_MAKE_EMPTY_EXIT]]:
; TRAP-UNREACHABLE-NEXT:    [[RETVAL_0_I:%.*]] = phi ptr [ [[ARRAYIDX_I]], %[[IF_END_I]] ]
; TRAP-UNREACHABLE-NEXT:    store i32 42, ptr [[RETVAL_0_I]], align 4
; TRAP-UNREACHABLE-NEXT:    ret ptr [[RETVAL_0_I]]
; TRAP-UNREACHABLE:       [[D_MAKE_EMPTY_EXIT_UB_PATH]]:
; TRAP-UNREACHABLE-NEXT:    [[RETVAL_0_I_UB_PATH:%.*]] = phi ptr [ null, %[[ENTRY]] ]
; TRAP-UNREACHABLE-NEXT:    call void @llvm.trap()
; TRAP-UNREACHABLE-NEXT:    unreachable
;
entry:
  %next_comp.i = getelementptr inbounds nuw i8, ptr %di, i64 8
  %0 = load i32, ptr %next_comp.i, align 8
  %num_comps.i = getelementptr inbounds nuw i8, ptr %di, i64 12
  %1 = load i32, ptr %num_comps.i, align 4
  %cmp.not.i = icmp slt i32 %0, %1
  br i1 %cmp.not.i, label %if.end.i, label %d_make_empty.exit

if.end.i:                                         ; preds = %entry
  %2 = load ptr, ptr %di, align 8
  %idxprom.i = sext i32 %0 to i64
  %arrayidx.i = getelementptr inbounds %struct.demangle_component, ptr %2, i64 %idxprom.i
  br label %d_make_empty.exit

d_make_empty.exit:                                ; preds = %entry, %if.end.i
  %retval.0.i = phi ptr [ %arrayidx.i, %if.end.i ], [ null, %entry ]
  store i32 42, ptr %retval.0.i, align 4
  ret ptr %retval.0.i
}

define i32 @test5() local_unnamed_addr {
; UNREACHABLE-LABEL: define i32 @test5() local_unnamed_addr {
; UNREACHABLE-NEXT:  [[ENTRY:.*]]:
; UNREACHABLE-NEXT:    [[TMP0:%.*]] = load ptr, ptr null, align 8
; UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr inttoptr (i64 128 to ptr), align 8
; UNREACHABLE-NEXT:    switch i32 [[TMP1]], label %[[SW_DEFAULT:.*]] [
; UNREACHABLE-NEXT:      i32 1, label %[[SW_EXIT:.*]]
; UNREACHABLE-NEXT:      i32 7, label %[[SW_EXIT]]
; UNREACHABLE-NEXT:      i32 8, label %[[SW_EXIT]]
; UNREACHABLE-NEXT:      i32 0, label %[[SW_EXIT]]
; UNREACHABLE-NEXT:    ]
; UNREACHABLE:       [[SW_DEFAULT]]:
; UNREACHABLE-NEXT:    br label %[[SW_EXIT_UB_PATH:.*]]
; UNREACHABLE:       [[SW_EXIT]]:
; UNREACHABLE-NEXT:    [[COMMON_RET1_OP_I_I:%.*]] = phi ptr [ [[TMP0]], %[[ENTRY]] ], [ [[TMP0]], %[[ENTRY]] ], [ [[TMP0]], %[[ENTRY]] ], [ [[TMP0]], %[[ENTRY]] ]
; UNREACHABLE-NEXT:    [[DP_I:%.*]] = getelementptr i8, ptr [[COMMON_RET1_OP_I_I]], i64 480
; UNREACHABLE-NEXT:    store i64 0, ptr [[DP_I]], align 8
; UNREACHABLE-NEXT:    ret i32 0
; UNREACHABLE:       [[SW_EXIT_UB_PATH]]:
; UNREACHABLE-NEXT:    unreachable
;
; TRAP-UNREACHABLE-LABEL: define i32 @test5() local_unnamed_addr {
; TRAP-UNREACHABLE-NEXT:  [[ENTRY:.*]]:
; TRAP-UNREACHABLE-NEXT:    [[TMP0:%.*]] = load ptr, ptr null, align 8
; TRAP-UNREACHABLE-NEXT:    [[TMP1:%.*]] = load i32, ptr inttoptr (i64 128 to ptr), align 8
; TRAP-UNREACHABLE-NEXT:    switch i32 [[TMP1]], label %[[SW_DEFAULT:.*]] [
; TRAP-UNREACHABLE-NEXT:      i32 1, label %[[SW_EXIT:.*]]
; TRAP-UNREACHABLE-NEXT:      i32 7, label %[[SW_EXIT]]
; TRAP-UNREACHABLE-NEXT:      i32 8, label %[[SW_EXIT]]
; TRAP-UNREACHABLE-NEXT:      i32 0, label %[[SW_EXIT]]
; TRAP-UNREACHABLE-NEXT:    ]
; TRAP-UNREACHABLE:       [[SW_DEFAULT]]:
; TRAP-UNREACHABLE-NEXT:    br label %[[SW_EXIT_UB_PATH:.*]]
; TRAP-UNREACHABLE:       [[SW_EXIT]]:
; TRAP-UNREACHABLE-NEXT:    [[COMMON_RET1_OP_I_I:%.*]] = phi ptr [ [[TMP0]], %[[ENTRY]] ], [ [[TMP0]], %[[ENTRY]] ], [ [[TMP0]], %[[ENTRY]] ], [ [[TMP0]], %[[ENTRY]] ]
; TRAP-UNREACHABLE-NEXT:    [[DP_I:%.*]] = getelementptr i8, ptr [[COMMON_RET1_OP_I_I]], i64 480
; TRAP-UNREACHABLE-NEXT:    store i64 0, ptr [[DP_I]], align 8
; TRAP-UNREACHABLE-NEXT:    ret i32 0
; TRAP-UNREACHABLE:       [[SW_EXIT_UB_PATH]]:
; TRAP-UNREACHABLE-NEXT:    [[COMMON_RET1_OP_I_I_UB_PATH:%.*]] = phi ptr [ null, %[[SW_DEFAULT]] ]
; TRAP-UNREACHABLE-NEXT:    call void @llvm.trap()
; TRAP-UNREACHABLE-NEXT:    unreachable
;
entry:
  %0 = load ptr, ptr null, align 8
  %1 = load i32, ptr inttoptr (i64 128 to ptr), align 8
  switch i32 %1, label %sw.default [
  i32 1, label %sw.exit
  i32 7, label %sw.exit
  i32 8, label %sw.exit
  i32 0, label %sw.exit
  ]

sw.default:                                      ; preds = %entry
  br label %sw.exit

sw.exit:                             ; preds = %if.else.i.i, %entry, %entry, %entry, %entry
  %common.ret1.op.i.i = phi ptr [ null, %sw.default ], [ %0, %entry ], [ %0, %entry ], [ %0, %entry ], [ %0, %entry ]
  %dp.i = getelementptr i8, ptr %common.ret1.op.i.i, i64 480
  store i64 0, ptr %dp.i, align 8
  ret i32 0
}

declare void @foo(i32 noundef)

declare void @bar(i32 noundef)
